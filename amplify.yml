version: 1
backend:
  phases:
    preBuild:
      commands:
        - node -v
        - curl -o- -L https://yarnpkg.com/install.sh | bash
        - yarn global add @aws-amplify/cli
    build:
      commands:
        - '# Execute Amplify CLI with the helper script'
        - amplifyPush --simple
frontend:
  phases:
    preBuild:
      commands:
        - npm uninstall @aws-amplify/cli
        - npm install -g colors@1.4.0 @aws-amplify/cli@6.4.0
        - amplifyPush --simple
        - yarn
        - yarn global add gatsby
        - yarn add @ardatan/aggregate-error
    build:
      commands:
        - yarn build --verbose
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
