version: 1
backend:
  phases:
    preBuild:
      commands:
        - npm install -g @aws-amplify/cli
        - export AWS_BRANCH=$(echo ${AWS_BRANCH} | tr "/" "-" | cut -c1-20) # prevent common and long git branch names (feat/something) to create an invalid stack/resource name
    build:
      commands:
        - '# Execute Amplify CLI with the helper script'
        - amplify push --yes
        - amplify pull --yes
frontend:
  phases:
    preBuild:
      commands:
        - yarn
        - yarn global add gatsby
    build:
      commands:
        - yarn build --verbose
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
